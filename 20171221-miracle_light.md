# Miracle Gift Paradeにおける3つのハートの色

サンリオピューロランドで行われているMiracle Gift Paradeでは音に合わせて光る色が変化する「ミラクル♡ライト」という応援グッズを使う。そのミラクル♡ライトの制御信号を解析した過程で、光り方がシナリオに合わせていることを客観的に説明できそうであったため、本稿ではそれを紹介する。

単に最初はライトを自前で制御したいだけだったのに、その課程でシナリオとの関連に気付いた時には驚かされた。例えるのなら、歌詞を耳で聞くだけではなく、歌詞を文字に書き起こすと歌詞の意味がより頭に入りやすくなる。それと同様に、ミラクル♡ライトが光るのを見るだけでなく音声コマンドを解析して点灯パターンを書き出すことで、点灯パターンに秘められた意図に気付けた。色以外にも点灯速度の微妙な調整があったりし、演出のこだわりが感じられた。

[![53AH4625](https://farm5.staticflickr.com/4357/36617297131_34cbff398c.jpg)](https://www.flickr.com/photos/ohtake_tomohiro/36617297131/)

## 作ったプログラム

<https://ohtake.github.io/miracle-light-controller/> をスマートフォンのブラウザやデスクトップのブラウザで開いてボタンを押すと、スピーカーから音が出るので、その音でミラクル♡ライトを制御できる。ライトに備わっている押しボタンだと白を除いた8色の常時点灯のみが制御できる。一方で音声コマンド経由だと62通りの点灯パターンで制御できる。消灯も入れると63通りである。

プログラム名がMiracle Heart Light ControllerではなくMiracle Light Controllerとしているのは、作り始めた当初の2017年11月24日時点でミラクルいちごライトがのちに控えていたためである。12月8日から発売されるミラクルいちごライトはミラクル♡ライトとは異なる光り方をするとの発表がなされていた。そのどちらにも対応させることを考えてプログラム名からheartを除いた。

ソースコードは <https://github.com/ohtake/miracle-light-controller/> にある。音を鳴らすコードは[mlc.js L159-L176](https://github.com/ohtake/miracle-light-controller/blob/blog-20171221/mlc.js#L159-L176)
で実質15行程度で済んでしまっている。

READMEに書いてあるように、ショー中に信号を出して演出を壊すようなことはしないように。

## 技術的な解説

技術的な解説は「[サンリオピューロランドのミラクル♡ライトの光り方を制御する。](http://titn-nanana.hatenablog.com/entry/2017/12/15/200000)」に任せた。ピューロランドに行ったことがないのにこんなニッチな解説を書くなんて感心してしまう。

時系列だと、自分は2017年11月24日に[音声データの分析をして信号の埋め込み方を見つけ](https://twitter.com/ohtaket/status/934070637630431235)、そこから2時間ほどかけて[信号音を発するプログラムの初期版を作り](https://twitter.com/ohtaket/status/934107952012713985)、そこからしばらく経ってからの11月28日に[全コマンドの分析を完了](https://twitter.com/ohtaket/status/935501400137592833)し[光り方とシナリオの関係](https://twitter.com/ohtaket/status/935501636490768386)をまとめるためにブログ記事を書こうかとしていたが、なかなか時間が取れず時間がたってしまった。そうこうしているうちの12月15日に先の解説を書いてくれた人がいたわけである。おかげで自分が技術的解説を書く手間が省けた。

先の解説を書いた人と自分とは独立に制御方法を解析したと思われる。なぜならば制御方法は単純な仕組みで、フーリエ変換さえすればすぐに気が付くことと、符号化方法に差異があることである。符号化においてはFM変調をビッグエンディアン的に解釈するのが先の解説記事で、自分のプログラムはリトルエンディアン的に解釈している。なぜならばリトルエンディアン的に解釈したほうが、数値順に並べた時に発色パターンの並びが整っているように見えたからだ。また点灯速度について自分はメトロノームを使っておおよその数値化をしてあるが、先の解説記事では体感的な速度しかいておらず細かな速度の違いまでは測定していない。

## 点灯の複合パターン

ミラクル♡ライトは赤・橙・桃・黄・緑・水・青・紫・白の9色を出すことができ、基本的には消灯か単一色常時点灯か単一色点滅のことが多い。しかしそのような単純な点灯以外にも複数の色を順に表示させる複合的な点灯をすることがある。わざわざ複合的な点灯をさせているということは、背後には当然意図があることだろう。

Miracle Gift Paradeで使っている複合的なパターンは主に4種類に分類できる。1つ目はkawaii, nakayoku, omoiyariの3つのハートに関するパターン。3つのハートのパターンを一文で説明するには難しいので後述する。2つ目は闇関係のパターンで紫と青の交互の点灯。3つ目は女王が白くなる直前の白と緑。最後の4つ目は赤・橙・桃・黄・緑・水・青・紫の8色を順に点灯させる虹だ。複合パターンの一覧は[mlc.js L273-L282](https://github.com/ohtake/miracle-light-controller/blob/blog-20171221/mlc.js#L273-L282)にある。

## 3つのハートの色

さて本題である。Miracle Gift Paradeは2015年12月から始まっているピューロランドのパレードで、もう2年も経っているからネタバレを気にせずに書くと、kawaiiとnakayokuとomoiyariの3つのハートが闇の女王にもあると気付かせるお話になっている。

DVDだと5チャプター目である『MIRACLE HEART LIGHT』で3つのハートの紹介が入る。3つのハートであるkawaii, nakayoku, omoiyariはそれぞれ点灯パターンが異なり、それは下表となっている。例えばkawaiiハートは3拍分の桃色点灯したのちに1拍分の赤色点灯する。3拍といっても3回光るわけではなく3拍分の長さで点灯し続けるものである。

|ハート|点灯パターン|
|----|----|
|kawaii|桃・桃・桃・赤|
|nakayoku|黄・黄・黄・緑|
|omoiyari|水・水・水・黄|

参考に3つのハートに対応するフロートの写真は以下に載せておいた。2017年12月時点のスポンサーのロゴが入っている写真を選んでおいた。

[![5D3X0662](https://farm2.staticflickr.com/1619/24408457546_af7a2fd9a3.jpg)](https://www.flickr.com/photos/ohtake_tomohiro/24408457546/)

[![53AI1491](https://farm5.staticflickr.com/4467/36554988234_602d0c1d05.jpg)](https://www.flickr.com/photos/ohtake_tomohiro/36554988234/)

[![53AE0665](https://farm3.staticflickr.com/2866/33959882602_3c38fe6a21.jpg)](https://www.flickr.com/photos/ohtake_tomohiro/33959882602/)

ライトの点灯パターンとフロートの色合いを比較すると、Kawaiiフロートは黄色と桃色で点灯パターンの桃色と赤色とは異なるが、nakayokuフロートとomoiyariフロートは点灯パターンと色合いが一致している。

点灯パターンに話を戻す。どのハートも3拍と1拍での2色の組合せになっている。いずれも2色であるが3拍分と長めの色がメインの色と考えられる。ハートの紹介順序であるkawaii, nakayoku, omoiyariで長い色となっているのは桃・黄・水である。この桃・黄・水のパターンはパレード中に何回か登場し、3つのハートを紹介する5チャプター目の『MIRACLE HEART LIGHT』や、女王が3つのハートに気付いて歌う8チャプター途中の『YOU BELIEVE』がある。

3つのそれぞれのハートの点灯パターンの長い色を組合せた桃・黄・水が、3つのハートの点灯パターンと一致していることは偶然ではなくきちんと狙ったものと考えるべきだろう。

## テンポの違い

色だけではなく光るテンポもミラクル♡ライトの演出として重要である。

Miracle Gift Paradeで使われている点灯パターンにおいては、闇のパターンである紫・青の信号にはテンポの速い1434123とテンポの遅い1412121があり、女王が登場するときは早いほうを、それ以外のところはテンポの遅いほうを使っている。テンポは倍ほど違うため、闇のパターンのテンポの違いは目視でもわかる。虹のパターンもテンポが倍ほど違うのでこれも目視で分かる。

一方でシナリオ的に最も重要である3つのハートの桃・黄・水のパターンを光らせるための信号は3234141と1414141があり、当初は信号が違うだけで光り方は同じだと思っていた。桃色や水色や白色の点滅も2種類ずつの信号があったが、これも単に重複して信号が登録されているだけだと思っていた。

しかし発色パターンを可視化する際にメトロノームを使ってテンポを調べたところ[同じ桃・黄・水のパターンでもテンポが微妙に異なることに気が付いた](https://twitter.com/ohtaket/status/935465773065166848)。具体的な数値だと55bpmと50bpmというほんの些細な違いだ。単純な点滅ではすべての色ごとに50bpmと60bpmの2種類が存在する。

55bpmと50bpmの違いは音で聞けばまあ分からなくもないが、ライトの点灯速度でそのテンポの違いに気が付くのは相当困難である。『MIRACLE HEART LIGHT』と『YOU BELIEVE』での桃・黄・水の点灯パターンで速度が微妙に違うことに気付いた人はいただろうか。

また3つのそれぞれのハートであるkawaii, omoiyari, nakayokuでは、kawaiiとnakayokuが80bpmであるのに対してomoiyariは65bpmとやや遅くなっている。どちらも長い光が3拍で短いのが1拍であるため、80bpmでは2.25秒と0.75秒で、65bpmでは2.77秒と0.92秒である。長い光が3拍分もあるため、これもテンポの違いに気が付きにくい。

テンポにこんな細かな調整までなされていて、演出のこだわりが垣間見えた。

## 残課題

* 2017年12月8日に発売になったミラクルいちごライトを12月20日に買ってきたが、まだ解析をしていない。発売前情報だと光り方がミラクル♡ライトと異なるらしい。
* Miracle Gift Parade以外でもミラクル♡ライトを使うショーがある。それらのショーでは別の点灯パターンを使っている。
  * 点灯パターンを書き出すことでそれらのショーの意図をさらに読み取れるだろうが、どれもDVDなどが出ておらず解析がしにくい。
  * またライトに組み込まれているパターンはMiracle Gift Paradeプレビューの時の2015年12月3日に購入したものとそのあとから購入したものでも同じになっている。そのためMiracle Gift Parade以外で使っているパターンを調べれば、他のショーの企画がどれくらい前から行われていたのかの推測もできる。
* 消灯の信号が3種類もあるが、それらの違いが分からない。
* 正確なbpmの測定。ミラクル♡ライトを光らせながらメトロノームでテンポを測定した。その際にメトロノームは5bpm単位でしか調整していないため±2bpm程度の誤差がある。
